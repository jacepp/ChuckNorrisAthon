"use strict";angular.module("chuckNorrisAthonApp",["ngSanitize","btford.socket-io"]).config(["socketProvider",function(a){var b=io.connect("http://localhost:3000");a.ioSocket(b)}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/thunder-dome",{templateUrl:"views/thunder-dome.html",controller:"ThunderDomeCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("chuckNorrisAthonApp").controller("MainCtrl",["$scope","$location","socket",function(a,b,c){a.submit=function(){c.emit("receive:name",{name:a.playerName},function(c){c?(a.$parent.playerName=a.playerName,b.path("/thunder-dome")):a.message="That name is already taken, try again."})}}]),angular.module("chuckNorrisAthonApp").controller("ThunderDomeCtrl",["$scope","$http","socket",function(a,b,c){c.forward("game:players",a),a.$on("socket:game:players",function(b,c){var d=c,e=c,f=c;d.sort(function(a,b){return a.wins-b.wins}),a.leadWins=d[d.length-1],e.sort(function(a,b){return a.streak-b.streak}),a.leadStreak=e[e.length-1],f.sort(function(a,b){return a.losses-b.losses}),a.leadLosses=f[f.length-1]})}]),angular.module("chuckNorrisAthonApp").controller("TheGameCtrl",["$scope","$http","socket",function(a,b,c){a.sansLeader="",a.leadChar="",c.emit("game:init"),c.forward("game:new",a),a.$on("socket:game:new",function(b,c){c=JSON.parse(c),a.joke=c.value.joke.replace(/&(quot);/g,'"'),a.sansLeader=a.joke,a.jokeCheck=c.value.joke.replace(/&(quot);/g,'"')}),c.forward("game:newcomer",a),a.$on("socket:game:newcomer",function(b,c){c=JSON.parse(c),a.joke=c.value.joke,a.sansLeader=a.joke,a.jokeCheck=c.value.joke}),c.forward("game:winner",a),a.$on("socket:game:winner",function(b,d){a.joke=d+" is the winner.",setTimeout(1e3),d==a.$parent.playerName&&c.emit("game:reset")}),c.forward("player:lead",a),a.$on("socket:player:lead",function(b,c){if(c.player!==a.$parent.playerName){a.leadChar=c.lead.substr(c.lead.length-1);var d="",e="";switch(a.sansLeader.length-a.jokeCheck.length){case 25:d=a.sansLeader.slice(0,c.lead.length+24),e=a.sansLeader.slice(c.lead.length+25);break;case 26:d=a.sansLeader.slice(0,c.lead.length+18),e=a.sansLeader.slice(c.lead.length+19);break;case 51:d=a.sansLeader.slice(0,c.lead.length+43),e=a.sansLeader.slice(c.lead.length+44);break;default:d=a.sansLeader.slice(0,c.lead.length-1),e=a.sansLeader.slice(c.lead.length)}a.joke=d+'<span class="leader">'+a.leadChar+"</span>"+e}}),a.capture=function(b){var d=b||"",e=a.jokeCheck,f=e.slice(0,d.length);if(f===d){if(f=f,f===a.jokeCheck&&c.emit("player:winner"),a.correct=f,a.charsLeft=e.substr(d.length),-1===a.joke.indexOf('<span class="leader">'))a.joke='<span class="win">'+a.correct+"</span>"+a.charsLeft,a.sansLeader=a.joke,c.emit("compare:inputs",d);else{var g="";g=a.joke.indexOf('<span class="fail">')>-1?a.joke.indexOf('<span class="win">')>-1?a.joke.indexOf('<span class="leader">')-51:a.joke.indexOf('<span class="leader">')-26:a.joke.indexOf('<span class="win">')>-1?a.joke.indexOf('<span class="leader">')-25:a.joke.indexOf('<span class="leader">');var h=g-a.correct.length,i=a.charsLeft.slice(0,h),j=a.charsLeft.slice(h+1);i.length!==j.length-1?a.joke='<span class="win">'+a.correct+"</span>"+i+'<span class="leader">'+a.leadChar+"</span>"+j:(a.joke='<span class="win">'+a.correct+"</span>"+a.charsLeft,a.sansLeader=a.joke)}c.emit("compare:inputs",d)}else if(-1!==a.joke.indexOf('<span class="leader">')){var g="";g=a.joke.indexOf('<span class="fail">')>-1?a.joke.indexOf('<span class="win">')>-1?a.joke.indexOf('<span class="leader">')-51:a.joke.indexOf('<span class="leader">')-26:a.joke.indexOf('<span class="win">')>-1?a.joke.indexOf('<span class="leader">')-25:a.joke.indexOf('<span class="leader">');var h=g-a.correct.length,i=a.charsLeft.slice(0,h),j=a.charsLeft.slice(h+1);i.length!==j.length-1?a.joke='<span class="win">'+a.correct+'</span></span><span class="fail">'+i+'<span class="leader">'+a.leadChar+"</span>"+j+"</span>":(a.joke='<span class="win">'+a.correct+'</span><span class="fail">'+a.charsLeft+"</span>",a.sansLeader=a.joke)}else a.correct?(a.joke='<span class="win">'+a.correct+'</span><span class="fail">'+a.charsLeft+"</span>",a.sansLeader=a.joke):(a.joke='<span class="fail">'+a.jokeCheck+"</span>",a.sansLeader=a.joke)}}]),angular.module("chuckNorrisAthonApp").controller("PlayersCtrl",["$scope","$http","socket","$location","$filter",function(a,b,c,d,e){c.emit("player:list"),c.forward("game:players",a),a.$on("socket:game:players",function(b,c){a.players=c||[];var e=!1;angular.forEach(a.players,function(b){b.name===a.$parent.playerName&&(e=!0)}),e||d.path("/")}),c.forward("player:new",a),a.$on("socket:player:new",function(b,c){a.players.push({name:c.name,wins:c.wins,streak:c.streak,losses:c.losses})}),c.forward("player:update",a),a.$on("socket:player:update",function(b,c){a.players=c}),c.forward("player:left",a),a.$on("socket:player:left",function(b,c){var d,e;for(d=0;d<a.players.length;d++)if(e=a.players[d],e.name===c.name){a.players.splice(d,1);break}}),a.iAm=function(){function b(b){return b.name!==a.$parent.playerName?1:b.name===a.$parent.playerName?-1:0}var c=a.players||[];return e("filter")(c.sort(b))}}]),angular.module("chuckNorrisAthonApp").directive("stopCheating",function(){return{restrict:"A",link:function(a,b){b.text("this is the stopCheating directive")}}}),angular.module("chuckNorrisAthonApp").directive("onKeyup",["socket",function(a){return function(b,c,d){c.bind("keyup",function(e){16!==e.keyCode&&b.$apply(d.onKeyup),a.forward("game:new",b),b.$on("socket:game:new",function(){c[0].value=""})})}}]);